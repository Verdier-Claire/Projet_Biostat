---
title: "Biostat_projet"
author: "Claire et Lucie"
date: "01/12/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyverse)
library(ggplot2)
library(MASS)
library(tinytex)
```

Le Danemark est un pays scandinave. Pour ce pays, nous allons étudier
les différentes causes de mortalités en fonction de l'âge des individus,
de la période où elles sont mortes.

# Explications du jeu de données

```{r}
mort <- read.csv("mortDK.csv", header = TRUE, sep = ";")
mort <- mort %>% rename("taux.deces" = rt, 
                        "Infections" = r1,
                        "Cancer"= r2,
                        "Tumeurs.Bénignes" = r3, 
                        "Endocrine" = r4, 
                        "Maladies.Sang" = r5, 
                        "Systeme.Nerveux" = r6, 
                        "Cerebrovasculaire" = r7, 
                        "Cardiaque" = r8, 
                        "Maladies.Respiratoires" = r9, 
                        "Maladies.Foie" = r10, 
                        "Maladies.Digestives" = r11, 
                        "Maladie.Génito_urinaire" = r12, 
                        "Non.Definis" = r13, 
                        "Mort.Naturelle" = r14,
                        "Mort.Violente" = r15) 

mort$taux.deces <- mort$taux.deces %>% as.numeric()
mort <- mort %>% filter(taux.deces <=100) # Certains taux de décès sont supérieurs à 100


mort$sex <- mort$sex %>% factor( labels = c("H", "F"))
mort$periode <- mort$periode %>% factor( labels =c("43-47", "48-52",
                                                   "53-57", "58-62",
                                                   "63-67", "68-72",
                                                   "73-77", "78-82",
                                                   "83-87", "88-92"))

mort <- mort %>% filter((age >=18) & (age <=25)) %>% 
  mutate("nb.Maladies.Foie" = round(Maladies.Foie*nb.deces), 
         "nb.Mort.Violente" = round(Mort.Violente*nb.deces))
mort <- mort %>%dplyr::select(age, periode, sex, PA, nb.deces, taux.deces, Maladies.Foie, 
         Mort.Violente, nb.Maladies.Foie, nb.Mort.Violente)
mort$age <- mort$age %>% factor()

```

Le jeux de données est composé de 1820 observations et 21 variables. Ces
variables sont l'âge, le sexe, la période, le nombre de décès, le taux
de décès et 15 variables sur l'identification du décès. Lorsque qu'on
parle d'identification du décès, on parle si la personne est morte d'un
cancer, d'une mort naturelle, par exemple. On sélectionne les variables
Maladies du foie et mort violente sur lesquels nous allons faire notre
étude.

La variable *taux.deces* est calculée d'après la formule suivante :
$$\mbox{taux.deces}=\frac{1000\times \mbox{nb.deces}}{PA}$$\
Les 15 variables d'identification du décès sont calculés de la même
manière.

Voici un exemple de notre jeu de données.

```{r}
head(mort)
```

Entre les années 1943 et 1948, 156342 personnées agées de 18ans étaient
de sexe masculins. 298 d'entre eux sont morts. Ce qui représente environ
1.906 individus issus de cette catégorie sur 1000 sont morts sur cette
période.\
Pour la période 1943-1947, pour les hommes agé de 18ans ans, le risque
de mourir d'une mort violente est de 0.991 et pour les femmes de cet âge
sur cette période, ce risque est de 0.287.

```{r}
# summary(mort)
ggplot(mort, aes( y=taux.deces, fill=sex))+ 
  geom_boxplot(aes(x=periode))+
  ggtitle("Le pourcentage de décès par période et sexe")+
  ylab("Pourcentage de décès")

```


Entre les années 1943 et 1948, 224 654 nourissons étaient de sexe masculin. 12 072 d'entre eux sont morts. Ce qui représente environ 53 individus issus de cette catégorie sur 1000 sont morts sur cette période. 

Au vu de notre jeu de données, il semble évident que nous allons réaliser une enquète de cohorte. En effet, la principale caractéristique d'une enquète de cohorte est qu'elle permet de suivre les individus dans le temps sur une période donnée.

De plus, nous savons que les résultats d'une enquète de cohorte peuvent être représentés sous 2 deux formes différentes. Ici, nous avons le cas où pour chaque combinaison de modalité des covariables, nous avons le nombre de décès observés pendant la période de suivie $[t_1,t_2]$ ainsi que le nombre de personnes-années correspondant. Nous avons un tableau de morbidité. 

Un individu pourra donc, au cours du suivi, contribuer aux personnes-années de différentes strates, si l'une au moins de ses covariables évolue au cours du temps.

Notre objectif est donc de déterminer si les covariables *âge, sexe* et *période* ont un effets sur les différentes causes de mortalité. Nous utiliserons des modèle de Poisson. 

Au vu de notre grand nombre d'observations, on décide de se restraindre à la tranche des 18-25ans.


Le graphique de taux de décès par période et par sexe nous montre une
grande différence entre les hommes et les femmes pour chaque année. De
plus, il semblerait que le taux de décès était largement supérieur pour
la période de 1943-1947. On peut se demander si cela est du à la seconde
guerre mondiale.


### Modalité de référence

```{r}
contrasts(mort$age)
contrasts(mort$periode)
contrasts(mort$sex)
```

La modalité de référence de  l'âge est 18ans. La modalité de référence pour
la période temporelle est entre 1943 et 1947. Enfin la modalité de
référence au niveau sexe est l'homme.


Au vu de notre grand nombre de type de décès, on décide de se concentrer sur 3 modèles : celui avec le nombre de décès, celui par décès de maladies du foie et enfin celui par mort violente.

## Etude du nombre de décès chez les jeunes de 18-25ans.
# ```{r}
# mdoel_nb_deces<-glm(nb.deces ~ periode * sex * age,  offset = log(PA), family = "poisson", data = mort)
# #summary(mdoel_nb_deces)
# ```
# 
# ```{r}
# glm.update <- update(mdoel_nb_deces)
# summary(stepAIC(glm.update))
# ```


Parmis la sous-strates 43-47, on fait la comparaison entre 2 sous strates :\
-la sous-strate "18 ans et sexe=H" : le rapport $\frac{nb.decss}{pa}$ est $e^{-6.24}$ \
-la sous-strate "18 ans et sexe=F" : le rapport $\frac{nb.decss}{pa}$ est $e^{-6.24}$x$e^{-0.40}$
  
Si on compare les deux dernieres sous-strates, le rapport d'incidence moyenne sexe feminin et sexe masculin, à âge fixé de 18 ans vaut $e^{-0.35}=0.67032$

## Etude des morts violentes chez les 18-25ans danois

Lorsqu'on parle de morts violentes, on fait souvent allusion à des décès
par traumatisme ou empoisonnement accidentels, par suicide ou par
homicide. Regardons tout d'abord un graphique en fonction du sexe de la
personne.

```{r}
 ggplot(mort)+ 
  geom_point(aes(x=age, y=Mort.Violente,  color=sex))+
  ggtitle("Morts violentes en fonction de l'âge")
```

Sur ce graphique, on voit clairement une différence entre les hommes et
les femmes par rapport aux morts violentes.

```{r}
model_nb_deces<-glm(nb.Mort.Violente ~ periode * sex * age,  offset = log(PA), 
                    family = "poisson", data = mort)
#model_nb_deces
#summary(model_nb_deces)
```

```{r}
glm.update <- update(model_nb_deces)
summary(stepAIC(glm.update))
```


Parmi la strate 43-47, on fait la comparaison entre deux sous-strates :\
- Pour la sous-strate "âge 18ans et sex=H", le rapport
$\frac{Mort.violentes}{pa}$ est $e^{-6.27}$\
- Pour la sous-strate "âge 18ans et sex=F", le rapport
$\frac{Mort.violentes}{pa}$ est $e^{-6.27}e^{-1.62}$ .\
Si on compare les deux dernières sous-strate :\
Le rapport d'incidence moyenne est entre le sexe masculin et le sexe
féminin, à âge fixé à 18 ans est de $e^{-1.62}= 0.1977195$.


## Etude des maladies du foie chez les jeunes de 18/25 ans

```{r}
#ggplot(mort)+
#  geom_point(aes(x=age, y=Maladies.Foie, color=sex))+
#  ggtitle("Nombre de décès par maladies de foie chez les danois de 18-25ans")
```
On remarque que ce sont les danoises plus touchées par les maladies de foie.
Regardons maintenant en focntion de la période :
```{r}
#ggplot(mort)+
#  geom_point(aes(x=age, y=Maladies.Foie, color=periode))+
#  ggtitle("Nombre de décès chez les danois de 18-25ans")
```



```{r}
#model_maladie.foie<-glm(nb.Maladies.Foie ~ periode * sex * age,  offset = log(PA), 
                        #family = "poisson", 
                        #data = mort)
#model_maladie.foie
#summary(model_maladie.foie)

#glm.update <- update(model_maladie.foie)
#summary(stepAIC(glm.update))
```
Parmis la sous-strates 43-47, on fait la comparaison entre 2 sous strates :\
-la sous-strate "18 ans et sexe=H" : le rapport $\frac{nb.maladies.foie}{pa}$ est $e^{-30.43}$\
-la sous-strate "18 ans et sexe=F" : le rapport $\frac{nb.decss}{pa}$ est $e^{-30.43}$x$e^{17.80}$
  
Si on compare les deux dernieres sous-strates, le rapport d'incidence moyenne sexe feminin et sexe masculin, à âge fixé de 18 ans vaut $e^{17.80}=53757836$



